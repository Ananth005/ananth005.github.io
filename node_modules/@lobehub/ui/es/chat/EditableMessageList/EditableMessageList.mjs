'use client';

import FlexBasic_default from "../../Flex/FlexBasic.mjs";
import ActionIcon_default from "../../ActionIcon/ActionIcon.mjs";
import Button_default from "../../Button/Button.mjs";
import ControlInput_default from "../../EditableText/ControlInput.mjs";
import Select_default from "../../Select/Select.mjs";
import { messagesReducer } from "./messageReducer.mjs";
import { memo, useEffect, useReducer } from "react";
import { jsx, jsxs } from "react/jsx-runtime";
import { Plus, Trash } from "lucide-react";
import isEqual from "fast-deep-equal";

//#region src/chat/EditableMessageList/EditableMessageList.tsx
const EditableMessageList = memo(({ disabled, dataSources, onChange }) => {
	const [chatMessages, dispatch] = useReducer(messagesReducer, dataSources);
	useEffect(() => {
		if (!isEqual(dataSources, chatMessages)) onChange?.(chatMessages);
	}, [chatMessages]);
	return dataSources ? /* @__PURE__ */ jsxs(FlexBasic_default, {
		gap: 12,
		children: [chatMessages.map((item, index) => /* @__PURE__ */ jsxs(FlexBasic_default, {
			align: "center",
			gap: 8,
			horizontal: true,
			width: "100%",
			children: [
				/* @__PURE__ */ jsx(Select_default, {
					disabled,
					onChange: (value) => {
						dispatch({
							index,
							role: value,
							type: "updateMessageRole"
						});
					},
					options: [
						{
							label: "System",
							value: "system"
						},
						{
							label: "Input",
							value: "user"
						},
						{
							label: "Output",
							value: "assistant"
						}
					],
					style: { width: 120 },
					styles: { popup: { root: { zIndex: 100 } } },
					value: item.role
				}),
				/* @__PURE__ */ jsx(ControlInput_default, {
					disabled,
					onChange: (e) => {
						dispatch({
							index,
							message: e,
							type: "updateMessage"
						});
					},
					placeholder: item.role === "user" ? "请填入输入的样例内容" : "请填入输出的样例",
					value: item.content
				}),
				/* @__PURE__ */ jsx(ActionIcon_default, {
					icon: Trash,
					onClick: () => {
						dispatch({
							index,
							type: "deleteMessage"
						});
					},
					title: "Delete",
					variant: "filled"
				})
			]
		}, `${index}-${item.content}`)), /* @__PURE__ */ jsx(Button_default, {
			block: true,
			disabled,
			icon: Plus,
			onClick: () => {
				dispatch({
					message: {
						content: "",
						role: chatMessages.at(-1)?.role === "user" ? "assistant" : "user"
					},
					type: "addMessage"
				});
			},
			children: "Add Props"
		})]
	}) : void 0;
}, isEqual);
EditableMessageList.displayName = "EditableMessageList";
var EditableMessageList_default = EditableMessageList;

//#endregion
export { EditableMessageList_default as default };
//# sourceMappingURL=EditableMessageList.mjs.map