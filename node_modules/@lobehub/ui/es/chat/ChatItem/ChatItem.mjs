'use client';

import FlexBasic_default from "../../Flex/FlexBasic.mjs";
import { useStyles } from "./style.mjs";
import Actions_default from "./components/Actions.mjs";
import Avatar_default from "./components/Avatar.mjs";
import BorderSpacing_default from "./components/BorderSpacing.mjs";
import ErrorContent_default from "./components/ErrorContent.mjs";
import MessageContent_default from "./components/MessageContent.mjs";
import Title_default from "./components/Title.mjs";
import { memo, useEffect, useRef, useState } from "react";
import { Fragment as Fragment$1, jsx, jsxs } from "react/jsx-runtime";
import { useResponsive } from "antd-style";

//#region src/chat/ChatItem/ChatItem.tsx
const MOBILE_AVATAR_SIZE = 32;
const ChatItem = memo(({ avatarAddon, onAvatarClick, avatarProps, actions, className, primary, loading, message, placeholderMessage = "...", placement = "left", variant = "bubble", avatar, error, showTitle, time, editing, onChange, onEditingChange, messageExtra, renderMessage, text, errorMessage, onDoubleClick, fontSize, aboveMessage, belowMessage, markdownProps, actionsWrapWidth = 54, showAvatar = true, titleAddon, ...rest }) => {
	const { mobile } = useResponsive();
	const { cx: cx$1, styles } = useStyles({
		editing,
		placement,
		primary,
		showTitle,
		time,
		title: avatar.title,
		variant
	});
	const contentRef = useRef(null);
	const containerRef = useRef(null);
	const [layoutMode, setLayoutMode] = useState(variant === "bubble" ? "horizontal" : "vertical");
	useEffect(() => {
		if (variant === "docs") {
			setLayoutMode("vertical");
			return;
		}
		if (!contentRef.current || !containerRef.current) return;
		const observer = new ResizeObserver(() => {
			if (!contentRef.current || !containerRef.current) return;
			const containerWidth = containerRef.current.clientWidth;
			const contentWidth = contentRef.current.scrollWidth;
			setLayoutMode(contentWidth + actionsWrapWidth > containerWidth ? "vertical" : "horizontal");
		});
		observer.observe(contentRef.current);
		observer.observe(containerRef.current);
		return () => observer.disconnect();
	}, [variant, actionsWrapWidth]);
	return /* @__PURE__ */ jsxs(FlexBasic_default, {
		className: cx$1(styles.container, className),
		direction: placement === "left" ? "horizontal" : "horizontal-reverse",
		gap: mobile ? 6 : 12,
		...rest,
		children: [
			showAvatar && /* @__PURE__ */ jsx(Avatar_default, {
				...avatarProps,
				addon: avatarAddon,
				alt: avatarProps?.alt || avatar.title || "avatar",
				avatar,
				loading,
				onClick: onAvatarClick,
				placement,
				size: mobile ? MOBILE_AVATAR_SIZE : void 0,
				style: {
					marginTop: showTitle ? -12 : 6,
					...avatarProps?.style
				}
			}),
			/* @__PURE__ */ jsxs(FlexBasic_default, {
				align: placement === "left" ? "flex-start" : "flex-end",
				className: styles.messageContainer,
				ref: containerRef,
				children: [
					/* @__PURE__ */ jsx(Title_default, {
						avatar,
						placement,
						showTitle,
						time,
						titleAddon
					}),
					aboveMessage,
					/* @__PURE__ */ jsxs(FlexBasic_default, {
						align: placement === "left" ? "flex-start" : "flex-end",
						className: styles.messageContent,
						"data-layout": layoutMode,
						direction: layoutMode === "horizontal" ? placement === "left" ? "horizontal" : "horizontal-reverse" : "vertical",
						gap: 8,
						children: [/* @__PURE__ */ jsx(FlexBasic_default, {
							ref: contentRef,
							width: "100%",
							children: error && (message === placeholderMessage || !message) ? /* @__PURE__ */ jsx(ErrorContent_default, {
								error,
								message: errorMessage,
								placement
							}) : /* @__PURE__ */ jsx(MessageContent_default, {
								editing,
								fontSize,
								markdownProps,
								message,
								messageExtra: /* @__PURE__ */ jsxs(Fragment$1, { children: [error && /* @__PURE__ */ jsx(ErrorContent_default, {
									error,
									message: errorMessage,
									placement
								}), messageExtra] }),
								onChange,
								onDoubleClick,
								onEditingChange,
								placement,
								primary,
								renderMessage,
								text,
								variant
							})
						}), actions && /* @__PURE__ */ jsx(Actions_default, {
							actions,
							editing,
							placement,
							variant
						})]
					}),
					belowMessage
				]
			}),
			mobile && variant === "bubble" && showAvatar && /* @__PURE__ */ jsx(BorderSpacing_default, { borderSpacing: MOBILE_AVATAR_SIZE })
		]
	});
});
var ChatItem_default = ChatItem;

//#endregion
export { ChatItem_default as default };
//# sourceMappingURL=ChatItem.mjs.map