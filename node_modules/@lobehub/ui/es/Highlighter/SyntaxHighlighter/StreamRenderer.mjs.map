{"version":3,"file":"StreamRenderer.mjs","names":["normalized: CSSProperties","style: CSSProperties"],"sources":["../../../src/Highlighter/SyntaxHighlighter/StreamRenderer.tsx"],"sourcesContent":["'use client';\n\nimport { getTokenStyleObject } from '@shikijs/core';\nimport type { CSSProperties } from 'react';\nimport { memo } from 'react';\nimport type { BuiltinTheme, ThemedToken } from 'shiki';\n\nimport { useHighlight } from '@/hooks/useHighlight';\n\nimport { useStyles } from './style';\n\ninterface StreamRendererProps {\n  children: string;\n  className?: string;\n  enableTransformer?: boolean;\n  fallbackClassName?: string;\n  language: string;\n  style?: CSSProperties;\n  theme?: BuiltinTheme;\n}\n\nconst applyColorReplacement = (color?: string, replacements?: Record<string, string>) => {\n  if (!color || !replacements) return color;\n  return replacements[color.toLowerCase()] || color;\n};\n\nconst normalizeStyleKeys = (style: Record<string, string | number>): CSSProperties => {\n  const normalized: CSSProperties = {};\n  Object.entries(style).forEach(([key, value]) => {\n    const normalizedKey = key.replaceAll(/-([a-z])/g, (_, char) => char.toUpperCase());\n    (normalized as Record<string, string | number>)[normalizedKey] = value;\n  });\n  return normalized;\n};\n\nconst getTokenInlineStyle = (\n  token: ThemedToken,\n  replacements?: Record<string, string>,\n): CSSProperties => {\n  const rawStyle = token.htmlStyle || getTokenStyleObject(token);\n  const baseStyle = normalizeStyleKeys(rawStyle);\n  if (!replacements) return { ...baseStyle, whiteSpace: 'pre' };\n\n  const style: CSSProperties = {\n    ...baseStyle,\n    whiteSpace: 'pre',\n  };\n\n  if (style.color && typeof style.color === 'string') {\n    style.color = applyColorReplacement(style.color, replacements);\n  }\n  if (style.backgroundColor && typeof style.backgroundColor === 'string') {\n    style.backgroundColor = applyColorReplacement(style.backgroundColor, replacements);\n  }\n\n  return style;\n};\n\nconst TokenSpan = memo(\n  ({ token, replacements }: { replacements?: Record<string, string>; token: ThemedToken }) => {\n    return (\n      <span key={token.content} style={getTokenInlineStyle(token, replacements)}>\n        {token.content}\n      </span>\n    );\n  },\n  (prev, next) => prev.token === next.token,\n);\n\nconst TokenLine = memo(\n  ({ line, replacements }: { line: ThemedToken[]; replacements?: Record<string, string> }) => {\n    if (!line.length) {\n      return (\n        <span className=\"line\">\n          <span style={{ whiteSpace: 'pre' }}>{'\\u00A0'}</span>\n        </span>\n      );\n    }\n\n    return (\n      <span className=\"line\">\n        {line.map((token, tokenIndex) => (\n          <TokenSpan key={`token-${tokenIndex}`} replacements={replacements} token={token} />\n        ))}\n      </span>\n    );\n  },\n  (prev, next) => prev.line === next.line,\n);\n\nconst StreamRenderer = memo<StreamRendererProps>(\n  ({ children, className, enableTransformer, fallbackClassName, language, style, theme }) => {\n    const { cx } = useStyles();\n\n    // Safely handle empty or invalid children\n    const safeChildren = children ?? '';\n\n    const { streaming } = useHighlight(safeChildren, {\n      enableTransformer,\n      language,\n      streaming: true,\n      theme,\n    });\n\n    const lines = streaming?.lines;\n    const preStyle = streaming?.preStyle;\n    const replacements = streaming?.colorReplacements;\n\n    if (!lines || lines.length === 0) {\n      return (\n        <div className={fallbackClassName} dir=\"ltr\" style={style}>\n          <pre>\n            <code>{safeChildren}</code>\n          </pre>\n        </div>\n      );\n    }\n\n    return (\n      <div className={className} dir=\"ltr\" style={style}>\n        <pre className={cx('shiki', theme)} style={preStyle} tabIndex={0}>\n          <code style={{ display: 'flex', flexDirection: 'column', whiteSpace: 'pre' }}>\n            {lines.map((line, index) => (\n              <TokenLine key={`line-${index}`} line={line} replacements={replacements} />\n            ))}\n          </code>\n        </pre>\n      </div>\n    );\n  },\n);\n\nStreamRenderer.displayName = 'StreamRenderer';\n\nexport default StreamRenderer;\n"],"mappings":";;;;;;;;;AAqBA,MAAM,yBAAyB,OAAgB,iBAA0C;AACvF,KAAI,CAAC,SAAS,CAAC,aAAc,QAAO;AACpC,QAAO,aAAa,MAAM,aAAa,KAAK;;AAG9C,MAAM,sBAAsB,UAA0D;CACpF,MAAMA,aAA4B,EAAE;AACpC,QAAO,QAAQ,MAAM,CAAC,SAAS,CAAC,KAAK,WAAW;EAC9C,MAAM,gBAAgB,IAAI,WAAW,cAAc,GAAG,SAAS,KAAK,aAAa,CAAC;AAClF,EAAC,WAA+C,iBAAiB;GACjE;AACF,QAAO;;AAGT,MAAM,uBACJ,OACA,iBACkB;CAElB,MAAM,YAAY,mBADD,MAAM,aAAa,oBAAoB,MAAM,CAChB;AAC9C,KAAI,CAAC,aAAc,QAAO;EAAE,GAAG;EAAW,YAAY;EAAO;CAE7D,MAAMC,QAAuB;EAC3B,GAAG;EACH,YAAY;EACb;AAED,KAAI,MAAM,SAAS,OAAO,MAAM,UAAU,SACxC,OAAM,QAAQ,sBAAsB,MAAM,OAAO,aAAa;AAEhE,KAAI,MAAM,mBAAmB,OAAO,MAAM,oBAAoB,SAC5D,OAAM,kBAAkB,sBAAsB,MAAM,iBAAiB,aAAa;AAGpF,QAAO;;AAGT,MAAM,YAAY,MACf,EAAE,OAAO,mBAAkF;AAC1F,QACE,oBAAC;EAAyB,OAAO,oBAAoB,OAAO,aAAa;YACtE,MAAM;IADE,MAAM,QAEV;IAGV,MAAM,SAAS,KAAK,UAAU,KAAK,MACrC;AAED,MAAM,YAAY,MACf,EAAE,MAAM,mBAAmF;AAC1F,KAAI,CAAC,KAAK,OACR,QACE,oBAAC;EAAK,WAAU;YACd,oBAAC;GAAK,OAAO,EAAE,YAAY,OAAO;aAAG;IAAgB;GAChD;AAIX,QACE,oBAAC;EAAK,WAAU;YACb,KAAK,KAAK,OAAO,eAChB,oBAAC;GAAoD;GAAqB;KAA1D,SAAS,aAA0D,CACnF;GACG;IAGV,MAAM,SAAS,KAAK,SAAS,KAAK,KACpC;AAED,MAAM,iBAAiB,MACpB,EAAE,UAAU,WAAW,mBAAmB,mBAAmB,UAAU,OAAO,YAAY;CACzF,MAAM,EAAE,OAAO,WAAW;CAG1B,MAAM,eAAe,YAAY;CAEjC,MAAM,EAAE,cAAc,aAAa,cAAc;EAC/C;EACA;EACA,WAAW;EACX;EACD,CAAC;CAEF,MAAM,QAAQ,WAAW;CACzB,MAAM,WAAW,WAAW;CAC5B,MAAM,eAAe,WAAW;AAEhC,KAAI,CAAC,SAAS,MAAM,WAAW,EAC7B,QACE,oBAAC;EAAI,WAAW;EAAmB,KAAI;EAAa;YAClD,oBAAC,mBACC,oBAAC,oBAAM,eAAoB,GACvB;GACF;AAIV,QACE,oBAAC;EAAe;EAAW,KAAI;EAAa;YAC1C,oBAAC;GAAI,WAAW,GAAG,SAAS,MAAM;GAAE,OAAO;GAAU,UAAU;aAC7D,oBAAC;IAAK,OAAO;KAAE,SAAS;KAAQ,eAAe;KAAU,YAAY;KAAO;cACzE,MAAM,KAAK,MAAM,UAChB,oBAAC;KAAsC;KAAoB;OAA3C,QAAQ,QAAmD,CAC3E;KACG;IACH;GACF;EAGX;AAED,eAAe,cAAc;AAE7B,6BAAe"}