{"version":3,"file":"TooltipGroup.mjs","names":["TooltipGroup: FC<TooltipGroupProps>","arrowMiddleware","TooltipFloating","TooltipPortal"],"sources":["../../src/Tooltip/TooltipGroup.tsx"],"sourcesContent":["'use client';\n\nimport {\n  arrow as arrowMiddleware,\n  autoUpdate,\n  flip,\n  offset,\n  shift,\n  useFloating,\n} from '@floating-ui/react';\nimport { type FC, type ReactNode, useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { antdPlacementToFloating } from '@/Tooltip/antdPlacementToFloating';\n\nimport TooltipFloating from './TooltipFloating';\nimport TooltipPortal from './TooltipPortal';\nimport {\n  TooltipGroupApiContext,\n  type TooltipGroupItem,\n  TooltipGroupPropsContext,\n  type TooltipGroupSharedProps,\n} from './groupContext';\n\ntype TooltipGroupProps = TooltipGroupSharedProps & {\n  children: ReactNode;\n};\n\nconst TooltipGroup: FC<TooltipGroupProps> = ({ children, ...sharedProps }) => {\n  const arrowRef = useRef<SVGSVGElement | null>(null);\n  const openTimerRef = useRef<number | null>(null);\n  const closeTimerRef = useRef<number | null>(null);\n\n  const [active, setActive] = useState<{\n    item: TooltipGroupItem;\n    triggerEl: HTMLElement;\n  } | null>(null);\n  const [open, setOpen] = useState(false);\n  const activeRef = useRef<typeof active>(null);\n\n  useEffect(() => {\n    activeRef.current = active;\n  }, [active]);\n\n  const floatingPlacement = useMemo(\n    () => antdPlacementToFloating(active?.item.placement),\n    [active?.item.placement],\n  );\n\n  const middleware = useMemo(() => {\n    const base = [offset(8), flip(), shift({ padding: 8 })];\n    if (active?.item.arrow) base.push(arrowMiddleware({ element: arrowRef }));\n    return base;\n  }, [active?.item.arrow]);\n\n  const { context, floatingStyles, refs } = useFloating({\n    middleware,\n    open,\n    placement: floatingPlacement,\n    whileElementsMounted: autoUpdate,\n  });\n\n  useEffect(() => {\n    if (!active?.triggerEl) return;\n    refs.setReference(active.triggerEl);\n  }, [active?.triggerEl, refs]);\n\n  const clearTimers = useCallback(() => {\n    if (openTimerRef.current) window.clearTimeout(openTimerRef.current);\n    if (closeTimerRef.current) window.clearTimeout(closeTimerRef.current);\n    openTimerRef.current = null;\n    closeTimerRef.current = null;\n  }, []);\n\n  const closeImmediately = useCallback(() => {\n    clearTimers();\n    setOpen(false);\n    activeRef.current?.item.onOpenChange?.(false);\n  }, [clearTimers]);\n\n  const destroyActive = useCallback(() => {\n    clearTimers();\n    setOpen(false);\n    activeRef.current?.item.onOpenChange?.(false);\n    setActive(null);\n  }, [clearTimers]);\n\n  const isActiveTrigger = useCallback((triggerEl: HTMLElement) => {\n    return Boolean(activeRef.current && activeRef.current.triggerEl === triggerEl);\n  }, []);\n\n  const closeFromTrigger = useCallback(\n    (triggerEl: HTMLElement, item: TooltipGroupItem) => {\n      if (!activeRef.current || activeRef.current.triggerEl !== triggerEl) return;\n\n      clearTimers();\n\n      const delayMs =\n        item.closeDelay ?? (item.mouseLeaveDelay !== undefined ? item.mouseLeaveDelay * 1000 : 100);\n      if (delayMs <= 0) {\n        setOpen(false);\n        item.onOpenChange?.(false);\n        return;\n      }\n\n      closeTimerRef.current = window.setTimeout(() => {\n        setOpen(false);\n        item.onOpenChange?.(false);\n      }, delayMs);\n    },\n    [clearTimers],\n  );\n\n  const openFromTrigger = useCallback(\n    (triggerEl: HTMLElement, item: TooltipGroupItem) => {\n      if (!triggerEl) return;\n      if (!item.title) return;\n      if (item.disabled) return;\n\n      clearTimers();\n\n      setActive({ item, triggerEl });\n\n      const delayMs =\n        item.openDelay ?? (item.mouseEnterDelay !== undefined ? item.mouseEnterDelay * 1000 : 100);\n      if (delayMs <= 0) {\n        if (!triggerEl.isConnected) {\n          destroyActive();\n          return;\n        }\n        setOpen(true);\n        item.onOpenChange?.(true);\n        return;\n      }\n\n      openTimerRef.current = window.setTimeout(() => {\n        if (!triggerEl.isConnected) {\n          destroyActive();\n          return;\n        }\n        setOpen(true);\n        item.onOpenChange?.(true);\n      }, delayMs);\n    },\n    [clearTimers, destroyActive],\n  );\n\n  const groupApi = useMemo(\n    () => ({ closeFromTrigger, closeImmediately, isActiveTrigger, openFromTrigger }),\n    [closeFromTrigger, closeImmediately, isActiveTrigger, openFromTrigger],\n  );\n\n  useEffect(() => {\n    if (!open) return;\n    const triggerEl = active?.triggerEl;\n    if (!triggerEl) return;\n\n    if (!triggerEl.isConnected) {\n      destroyActive();\n      return;\n    }\n\n    const root = triggerEl.getRootNode?.();\n    const observeTarget =\n      typeof ShadowRoot !== 'undefined' && root instanceof ShadowRoot\n        ? root\n        : (triggerEl.ownerDocument ?? document);\n\n    const observer = new MutationObserver(() => {\n      if (!triggerEl.isConnected) destroyActive();\n    });\n\n    observer.observe(observeTarget, { childList: true, subtree: true });\n\n    return () => observer.disconnect();\n  }, [active?.triggerEl, destroyActive, open]);\n\n  useEffect(() => {\n    return () => {\n      clearTimers();\n    };\n  }, [clearTimers]);\n\n  const portalRoot =\n    active?.item.getPopupContainer && active?.triggerEl\n      ? active.item.getPopupContainer(active.triggerEl)\n      : undefined;\n\n  const floatingNode = (\n    <TooltipFloating\n      arrow={active?.item.arrow}\n      arrowRef={arrowRef}\n      className={active?.item.className}\n      classNames={active?.item.classNames}\n      context={context}\n      floatingStyles={floatingStyles}\n      hotkey={active?.item.hotkey}\n      hotkeyProps={active?.item.hotkeyProps}\n      open={open}\n      placement={floatingPlacement}\n      setFloating={refs.setFloating}\n      styles={active?.item.styles}\n      title={active?.item.title}\n      zIndex={active?.item.zIndex}\n    />\n  );\n\n  return (\n    <TooltipGroupApiContext.Provider value={groupApi}>\n      <TooltipGroupPropsContext.Provider value={sharedProps}>\n        {children}\n        {active?.item.title &&\n          !active.item.disabled &&\n          ((active.item.portalled ?? true) ? (\n            <TooltipPortal root={portalRoot}>{floatingNode}</TooltipPortal>\n          ) : (\n            floatingNode\n          ))}\n      </TooltipGroupPropsContext.Provider>\n    </TooltipGroupApiContext.Provider>\n  );\n};\n\nexport default TooltipGroup;\n"],"mappings":"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"}